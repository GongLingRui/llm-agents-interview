### Analyze（分析）阶段
**副标题**：从“下游问题”到“上游错误”的分析

#### 1. 数据准备
- 目标：收集用于调试的“日志（Traces）”。
- 核心：系统性地覆盖“失败边界”。
- 数据源：优先使用**真实用户数据**，不足时再**系统性合成**。
- Trace 定义：AI执行任务的完整日志（含思考链、工具调用等）。


#### 2. 开放编码
- 目标：找到多米诺骨牌倒下的“第一张牌”。
- 核心：记录“**第一个上游错误**”，而非下游问题。


#### 3. 轴向编码
- 目标：将“上游错误”聚类，量化“**失败模式**”。
- 核心：AI辅助 + **PM精炼**，产出“失败排行榜”。

### 步骤1: 数据准备（Data Prep）
**所属阶段**：分析（Analyze）
**数据优先级**：真实用户数据 > 系统性合成数据

#### 定义复合型维度
- **用户画像 (Persona)**：
  - P1: 销售总监（关注宏观GMV，语气强势）
  - P2: 市场经理（关注细分ROI，语气分析）
- **核心功能 (Core Feature)**：
  - F1: 查询单一指标（GMV是多少?）
  - F2: 查询多指标对比（对比GMV和利润）
- **场景挑战 (Scenario Challenge)**：
  - S-Date: 复杂日期（上个月, 去年Q3）
  - S-Entity: 复杂实体（亚太区, 亚洲(不含日本)）

#### 三步生成查询
1. **生成元组 (Tuples)**：
   示例：(P1:销售总监, F1:查询单一指标, S-Date:上个月, S-Entity:亚太区)
2. **筛选元组 (Filter)**：
   人工（你）剔除无效或低价值的组合。
3. **生成查询 (Generate)**：
   用LLM将“元组”（骨架）填充为“自然语言”（血肉）。
   示例LLM生成指令：
   扮演：[P1：销售总监]
   需要：[F1：查询单一指标]
   关于：[S-Date：上个月]，[S-Entity：亚太区]
   生成："上个月亚太区的 GMV 到底是多少？数据准不准？"

### 步骤 2: 开放编码 (Open Coding)

#### 一、锁定“第一个上游错误”
以用户请求“给我展示 '上个月' '亚太区' 的销售额”为例：
- **步骤 1：思考**
  - 定义 '上个月' = '过去30天'（错误 A）
  - 定义 '亚太区' = ['日本', '澳大利亚']（错误 B）
  - 发现错误后**停！**
- **步骤 2：生成 SQL**
  - `SELECT ... WHERE 日期 > NOW() - '30 days'`（语法正确）
- **步骤 3：结果**
  - ￥500,000（下游问题：数字错误）


#### 二、记录“第一个上游错误”
- **笔记示例**
  - 笔记 1：“业务术语混淆: '上个月' 被误解为 '过去30天'。”
  - 笔记 2：“业务实体定义不全: '亚太区' 缺少 '新加坡'。”
- **核心技巧**
  从上往下读Trace，一旦找到**第一个错误（步骤1）**，记录下来，然后**立刻停止分析本条Trace**，进入下一条。
- **分析数量（理论饱和点）**
  至少分析 **~100条 Trace**，直到感觉**不再发现新的错误类型**为止。


### 步骤 3: 轴向编码 (Axial Coding)

#### “AI辅助 + PM精炼”两步法
1. **AI 辅助聚类**：
   将 100 条“开放编码”笔记喂给 LLM，让它做初步聚类。
2. **PM 人工精炼**：
   你必须介入！合并、重命名 AI 的分类，形成自己的“失败模式分类法”。
   - 示例：
     - AI 初稿：日期问题、区域问题
     - PM 精炼后：失败模式 1：业务术语解析失败
   - 注意：此过程通常需要迭代！在得到第一版分类法后，最好再回去验证（看更多Trace），通常需要2轮左右才能稳定。


#### 产出: “失败模式排行榜”
- 工具：使用最简单的工具**计数 (Counting)**，得到清晰的行动优先级假设。
- 示例排名：
  - 失败模式 1: 业务术语-日期解析… 30%
  - 失败模式 2: 业务术语-实体定义… 25%
  - 失败模式 3: SQL聚合逻辑错误 15%
  - 失败模式 4: SQL语法错误 0%
- 结论（基于样本分析）：**失败模式 1 和 失败模式 2** 很可能是最高优先级问题。
- 下一步（Measure阶段）：构建评估器以验证其在大规模数据上的真实影响。
